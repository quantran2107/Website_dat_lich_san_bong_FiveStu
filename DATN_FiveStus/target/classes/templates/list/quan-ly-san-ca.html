<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:include="fragment/head :: head"></head>
<body class="vertical light">
<div class="wrapper">
    <div th:include="fragment/navbar :: navbar"></div>
    <div th:include="fragment/sidebar :: sidebar"></div>
    <main role="main" class="main-content">
        <div class="container-fluid">
            <div class="row justify-content-center">
                <div class="col-12">
                    <h2 class="mb-2 page-title">Quản lý sân ca</h2>
                    <div class="row my-4">
                        <div class="col-md-12">
                            <form action="/listSanCa" method="get" class="form-inline">
                                <label  class="mr-2">Filter:</label>
                                <input type="text"  name="keyWords" class="form-control mr-2">
                                <button type="submit" class="btn btn-primary">Search</button>
                            </form>
                        </div>
                    </div>



                    <div class="mt-3">
                        <a th:href="@{/export/excels}" class="btn btn-success">Export Excel</a>
                    </div>

                    <div class="row my-4">
                        <div class="col-md-12">
                            <div class="card shadow">
                                <div class="card-body">
                                    <div class="toolbar row mb-3">
                                        <div class="col ml-auto">
                                            <div class="dropdown float-right">
                                                <button type="button" class="btn btn-primary float-right ml-3"
                                                        data-toggle="modal" data-target="#varyModal"
                                                        data-whatever="@mdo">Thêm<span class="fe fe-plus"></span>
                                                </button>
                                                <div class="modal fade" id="varyModal" tabindex="-1" role="dialog"
                                                     aria-labelledby="varyModalLabel" aria-hidden="true">
                                                    <div class="modal-dialog" role="document">
                                                        <div class="modal-content">
                                                            <div class="modal-header">
                                                                <h5 class="modal-title" id="varyModalLabel">Thêm sân
                                                                    ca</h5>
                                                                <button type="button" class="close" data-dismiss="modal"
                                                                        aria-label="Close">
                                                                    <span aria-hidden="true">&times;</span>
                                                                </button>
                                                            </div>
                                                            <div class="modal-body">
                                                                <form th:action="@{/sanCa/add}" th:object="${sanCa}"
                                                                      th:method="post">
                                                                    <input type="hidden" th:field="*{id}" id="addId">
                                                                    <div class="form-row">
                                                                        <div class="form-group col-md-6">
                                                                            <label for="addCa">Ca</label>
                                                                            <select id="addCa" class="form-control"
                                                                                    th:field="*{idCa}">
                                                                                <option th:each="a : ${listC}"
                                                                                        th:value="${a.id}"
                                                                                        th:text="${a.tenCa}"></option>
                                                                            </select>
                                                                        </div>
                                                                    </div>
                                                                    <div class="form-row">
                                                                        <div class="form-group col-md-6">
                                                                            <label for="addSanBong">Sân bóng</label>
                                                                            <select id="addSanBong" class="form-control"
                                                                                    th:field="*{idSanBong}">
                                                                                <option th:each="b : ${listSB}"
                                                                                        th:value="${b.id}"
                                                                                        th:text="${b.tenSanBong}"></option>
                                                                            </select>
                                                                        </div>
                                                                    </div>
                                                                    <div class="form-row">
                                                                        <div class="form-group col-md-6">
                                                                            <label for="addNgayTrongTuan">Ngày trong
                                                                                tuần</label>
                                                                            <select id="addNgayTrongTuan"
                                                                                    class="form-control"
                                                                                    th:field="*{idNgayTrongTuan}">
                                                                                <option th:each="c : ${listNTT}"
                                                                                        th:value="${c.id}"
                                                                                        th:text="${c.thuTrongTuan}"></option>
                                                                            </select>
                                                                        </div>
                                                                    </div>
                                                                    <div class="form-row">
                                                                        <div class="form-group col-md-6">
                                                                            <label for="addTrangThai">Trạng thái</label>
                                                                            <select id="addTrangThai"
                                                                                    class="form-control"
                                                                                    th:field="*{trangThai}">
                                                                                <option th:each="d : ${listTT}"
                                                                                        th:value="${d}"
                                                                                        th:text="${d}"></option>
                                                                            </select>
                                                                        </div>
                                                                    </div>
                                                                    <div class="form-row">
                                                                        <label for="addGia">Giá</label>
                                                                        <input type="text" class="form-control"
                                                                               th:field="*{gia}" id="addGia">
                                                                    </div>
                                                                    <div class="modal-footer">
                                                                        <button type="button"
                                                                                class="btn mb-2 btn-secondary"
                                                                                data-dismiss="modal">Close
                                                                        </button>
                                                                        <button type="submit"
                                                                                class="btn mb-2 btn-primary">ADD
                                                                        </button>
                                                                    </div>
                                                                </form>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <button class="btn btn-secondary dropdown-toggle" type="button"
                                                        id="actionMenuButton" data-toggle="dropdown"
                                                        aria-haspopup="true" aria-expanded="false"
                                                        th:disabled="${#lists.isEmpty(sanCaDTOList)}"> Hành động
                                                </button>
                                                <div class="dropdown-menu" aria-labelledby="actionMenuButton">
                                                    <a class="dropdown-item" href="#">Export</a>
                                                    <a class="dropdown-item" href="#">Something else here</a>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <table class="table">
                                        <thead>
                                        <tr>
                                            <th class="gray-white-background">
                                                <a th:href="@{/listSanCa(pageNum=${currentPage}, sortField='tenCa', sortDirection=${sortDirection == 'asc' ? 'desc' : 'asc'})}">STT</a>
                                            </th>
                                            <th class="gray-white-background">
                                                <a th:href="@{/listSanCa(pageNum=${currentPage}, sortField='tenCa', sortDirection=${sortDirection == 'asc' ? 'desc' : 'asc'})}">Tên Sân Ca</a>
                                            </th>
<!--                                            <th class="gray-white-background">-->
<!--                                                <a th:href="@{/listSanCa(pageNum=${currentPage}, sortField='tenSanBong', sortDirection=${sortDirection == 'asc' ? 'desc' : 'asc'})}">Tên Sân Bóng</a>-->
<!--                                            </th>-->
                                            <th class="gray-white-background">
                                                <a th:href="@{/listSanCa(pageNum=${currentPage}, sortField='thoiGianBatDauCa', sortDirection=${sortDirection == 'asc' ? 'desc' : 'asc'})}">Bắt đầu</a>
                                            </th>
                                            <th class="gray-white-background">
                                                <a th:href="@{/listSanCa(pageNum=${currentPage}, sortField='thoiGianKetThucCa', sortDirection=${sortDirection == 'asc' ? 'desc' : 'asc'})}">Kết thúc</a>
                                            </th>
                                            <th class="gray-white-background">
                                                <a th:href="@{/listSanCa(pageNum=${currentPage}, sortField='thuTrongTuan', sortDirection=${sortDirection == 'asc' ? 'desc' : 'asc'})}">Ngày Trong Tuần</a>
                                            </th>
                                            <th class="gray-white-background">
                                                <a th:href="@{/listSanCa(pageNum=${currentPage}, sortField='trangThai', sortDirection=${sortDirection == 'asc' ? 'desc' : 'asc'})}">Trạng Thái</a>
                                            </th>
                                            <th class="gray-white-background">
                                                <a th:href="@{/listSanCa(pageNum=${currentPage}, sortField='gia', sortDirection=${sortDirection == 'asc' ? 'desc' : 'asc'})}">Giá</a>
                                            </th>
                                            <th class="gray-white-background">Hành động</th>
                                        </tr>
                                        </thead>


                                        <tbody>
                                        <tr th:each="a, b : ${sanCaDTOList}">
                                            <td th:text="${b.count}"></td>
                                            <td th:text="${a.tenSanBong + '-' + a.tenCa}"></td>
<!--                                            <td th:text="${a.tenSanBong}"></td>-->
                                            <td th:text="${#temporals.format(a.thoiGianBatDauCa, 'HH:mm')}"></td>
                                            <td th:text="${#temporals.format(a.thoiGianKetThucCa, 'HH:mm')}"></td>
                                            <td th:text="${a.thuTrongTuan}"></td>
                                            <td th:text="${a.trangThai}"></td>
                                            <td>
                                                <span th:if="${#temporals.format(a.thoiGianBatDauCa, 'HH:mm') >= '08:00' and #temporals.format(a.thoiGianKetThucCa, 'HH:mm') <= '18:00'}" th:text="${a.gia * 1.5}"></span>
                                                <span th:unless="${#temporals.format(a.thoiGianBatDauCa, 'HH:mm') >= '08:00' and #temporals.format(a.thoiGianKetThucCa, 'HH:mm') <= '18:00'}" th:text="${a.gia}"></span>
                                            </td>
                                            <td>
                                                <button type="button" class="btn btn-success edit-btn"
                                                        data-toggle="modal" data-target="#editModal"
                                                        th:attr="data-id=${a.id}"
                                                        th:disabled="${#lists.isEmpty(sanCaDTOList)}">Edit
                                                </button>
                                            </td>
                                        </tr>
                                        </tbody>
                                    </table>


                                    <div class="pagination">
                                        <ul class="pagination">
                                            <!-- Nút Previous -->
                                            <li class="page-item" th:classappend="${currentPage == 1} ? 'disabled'">
                                                <a class="page-link"
                                                   th:href="@{/listSanCa(pageNum=${currentPage - 1}, sortField=${sortField}, sortDirection=${sortDirection})}">&laquo;</a>
                                            </li>

                                            <!-- Danh sách các trang -->
                                            <li class="page-item" th:each="i : ${#numbers.sequence(1, totalPages)}"
                                                th:classappend="${i == currentPage} ? 'active'">
                                                <a class="page-link"
                                                   th:href="@{/listSanCa(pageNum=${i}, sortField=${sortField}, sortDirection=${sortDirection})}"
                                                   th:text="${i}"></a>
                                            </li>

                                            <!-- Nút Next -->
                                            <li class="page-item"
                                                th:classappend="${currentPage == totalPages} ? 'disabled'">
                                                <a class="page-link"
                                                   th:href="@{/listSanCa(pageNum=${currentPage + 1}, sortField=${sortField}, sortDirection=${sortDirection})}">&raquo;</a>
                                            </li>
                                        </ul>
                                    </div>


                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
        <div th:include="fragment/modal :: modal"></div>
    </main>
</div>

<!-- Modal Edit -->
<div class="modal fade" id="editModal" tabindex="-1" role="dialog" aria-labelledby="editModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editModalLabel">Chỉnh sửa sân ca</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form th:action="@{/sanCa/update}" th:object="${sanCa}" th:method="post">
                    <input type="hidden" th:field="*{id}" id="editId">
                    <div class="form-row">
                        <div class="form-group col-md-6">
                            <label for="editCa">Ca</label>
                            <select id="editCa" class="form-control" th:field="*{idCa}">
                                <option th:each="a : ${listC}" th:value="${a.id}" th:text="${a.tenCa}"></option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group col-md-6">
                            <label for="editSanBong">Sân bóng</label>
                            <select id="editSanBong" class="form-control" th:field="*{idSanBong}">
                                <option th:each="b : ${listSB}" th:value="${b.id}" th:text="${b.tenSanBong}"></option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group col-md-6">
                            <label for="editNgayTrongTuan">ngayTrongTuan</label>
                            <select id="editNgayTrongTuan" class="form-control" th:field="*{idNgayTrongTuan}">
                                <option th:each="c : ${listNTT}" th:value="${c.id}"
                                        th:text="${c.thuTrongTuan}"></option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group col-md-6">
                            <label for="editTrangThai">trangThai</label>
                            <select id="editTrangThai" class="form-control" th:field="*{trangThai}">
                                <option th:each="d : ${listTT}" th:value="${d}" th:text="${d}"></option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <label for="editGia">Gia</label>
                        <input type="text" class="form-control" th:field="*{gia}" id="editGia">
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn mb-2 btn-secondary" data-dismiss="modal">Close</button>
                        <button type="submit" class="btn mb-2 btn-primary">UPDATE</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- JavaScript -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    $(document).ready(function () {
        $('.edit-btn').on('click', function () {
            var id = $(this).data('id');
            $.ajax({
                url: '/sanCa/edit/' + id,
                method: 'GET',
                success: function (data) {
                    $('#editId').val(data.id);
                    $('#editCa').val(data.idCa);
                    $('#editSanBong').val(data.idSanBong);
                    $('#editNgayTrongTuan').val(data.idNgayTrongTuan);
                    $('#editTrangThai').val(data.trangThai);
                    $('#editGia').val(parseFloat(data.gia));
                }
            });
        });
    });
</script>
</body>
<div th:include="fragment/script :: script"></div>
</html>
